{% extends "base.html" %}  

{% block title %}SFT心理咨询 - 对话{% endblock %}  

{% block styles %}  
<link rel="stylesheet" href="/static/css/style.css">  
<style>  
    .loading-dots::after {  
        content: '...';  
        animation: dots 1.5s steps(4, end) infinite;  
    }  
    @keyframes dots {  
        0%, 20% { content: '.'; }  
        40% { content: '..'; }  
        60% { content: '...'; }  
        80%, 100% { content: ''; }  
    }  
    .chat-container {
        height: calc(100vh - 2rem);
        overflow: hidden;
    }
    .side-panel {
        height: calc(100vh - 2rem);
    }
</style>  
{% endblock %}  

{% block content %}  
<div class="container mx-auto p-4">  
    <div class="grid grid-cols-4 gap-4">  
        <!-- 左侧阶段列表 -->  
        <div class="col-span-1 bg-white rounded-lg p-4 shadow side-panel">  
            <h2 class="text-lg font-bold mb-4">阶段列表</h2>  
            <div id="states-list" class="space-y-2">  
                <!-- 阶段列表将在这里动态生成 -->  
            </div>  
        </div>  

        <!-- 中间聊天区域 -->  
        <div class="col-span-2 flex flex-col bg-white rounded-lg shadow chat-container">  
            <div class="p-4 border-b">  
                <h2 class="text-lg font-bold">当前阶段：<span id="current-stage-display">未设置</span></h2>  
            </div>  
            <div id="chat-messages" class="flex-1 p-4 space-y-4 overflow-y-auto" style="height: calc(100% - 140px);">  
                <!-- 消息将在这里动态生成 -->  
            </div>  
            <div class="p-4 border-t mt-auto">  
                <div class="flex space-x-2">  
                    <input type="text" id="message-input"   
                           class="flex-1 border rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500"  
                           placeholder="输入消息...">  
                    <button id="send-button"   
                            class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600">  
                        发送  
                    </button>  
                </div>  
            </div>  
        </div>  

        <!-- 右侧阶段指导 -->  
        <div class="col-span-1 bg-white rounded-lg p-4 shadow side-panel">  
            <h2 class="text-lg font-bold mb-4">阶段指导</h2>  
            <textarea id="stage-guide-content"   
                      class="w-full h-[calc(100%-8rem)] border rounded-lg p-2 mb-4 resize-none"  
                      placeholder="阶段指导内容..."></textarea>  
            <button id="save-guide-btn"   
                    class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">  
                保存修改  
            </button>  
        </div>  
    </div>  
</div>  
{% endblock %}  

{% block scripts %}  
{{ super() }}  
<script src="static/js/api.js"></script>  
<script src="static/js/ui.js"></script>  
<script src="static/js/chat.js"></script>  
<script src="static/js/main.js"></script>  
{% endblock %}